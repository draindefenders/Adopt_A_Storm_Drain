{"ast":null,"code":"/**\n * @module ol/format/IIIFInfo\n */\nimport { assert } from '../asserts.js';\n/**\n * @typedef {Object} PreferredOptions\n * @property {string} [format] Preferred image format. Will be used if the image information\n * indicates support for that format.\n * @property {string} [quality] IIIF image qualitiy.  Will be used if the image information\n * indicates support for that quality.\n */\n\n/**\n * @typedef {Object} SupportedFeatures\n * @property {Array<string>} [supports] Supported IIIF image size and region\n * calculation features.\n * @property {Array<string>} [formats] Supported image formats.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n */\n\n/**\n * @typedef {Object} TileInfo\n * @property {Array<number>} scaleFactors Supported resolution scaling factors.\n * @property {number} width Tile width in pixels.\n * @property {number} [height] Tile height in pixels. Same as tile width if height is\n * not given.\n */\n\n/**\n * @typedef {Object} IiifProfile\n * @property {Array<string>} [formats] Supported image formats for the image service.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n * @property {Array<string>} [supports] Supported features.\n * @property {number} [maxArea] Maximum area (pixels) available for this image service.\n * @property {number} [maxHeight] Maximum height.\n * @property {number} [maxWidth] Maximum width.\n */\n\n/**\n * @typedef {Object<string,string|number|Array<number|string|IiifProfile>|Object<string, number>|TileInfo>}\n *    ImageInformationResponse\n */\n\n/**\n * Enum representing the major IIIF Image API versions\n * @enum {string}\n */\n\nvar Versions = {\n  VERSION1: 'version1',\n  VERSION2: 'version2',\n  VERSION3: 'version3'\n};\n/**\n * Supported image formats, qualities and supported region / size calculation features\n * for different image API versions and compliance levels\n * @const\n * @type {Object<string, Object<string, SupportedFeatures>>}\n */\n\nvar IIIF_PROFILE_VALUES = {};\nIIIF_PROFILE_VALUES[Versions.VERSION1] = {\n  'level0': {\n    supports: [],\n    formats: [],\n    qualities: ['native']\n  },\n  'level1': {\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n    formats: ['jpg'],\n    qualities: ['native']\n  },\n  'level2': {\n    supports: ['regionByPx', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct', 'sizeByConfinedWh', 'sizeByWh'],\n    formats: ['jpg', 'png'],\n    qualities: ['native', 'color', 'grey', 'bitonal']\n  }\n};\nIIIF_PROFILE_VALUES[Versions.VERSION2] = {\n  'level0': {\n    supports: [],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level1': {\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level2': {\n    supports: ['regionByPx', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct', 'sizeByConfinedWh', 'sizeByDistortedWh', 'sizeByWh'],\n    formats: ['jpg', 'png'],\n    qualities: ['default', 'bitonal']\n  }\n};\nIIIF_PROFILE_VALUES[Versions.VERSION3] = {\n  'level0': {\n    supports: [],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level1': {\n    supports: ['regionByPx', 'regionSquare', 'sizeByW', 'sizeByH', 'sizeByWh'],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level2': {\n    supports: ['regionByPx', 'regionSquare', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct', 'sizeByConfinedWh', 'sizeByWh'],\n    formats: ['jpg', 'png'],\n    qualities: ['default']\n  }\n};\nIIIF_PROFILE_VALUES['none'] = {\n  'none': {\n    supports: [],\n    formats: [],\n    qualities: []\n  }\n};\nvar COMPLIANCE_VERSION1 = new RegExp('^https?\\:\\/\\/library\\.stanford\\.edu\\/iiif\\/image-api\\/(1\\.1\\/)?compliance\\.html#level[0-2]$');\nvar COMPLIANCE_VERSION2 = new RegExp('^https?\\:\\/\\/iiif\\.io\\/api\\/image\\/2\\/level[0-2](\\.json)?$');\nvar COMPLIANCE_VERSION3 = new RegExp('(^https?\\:\\/\\/iiif\\.io\\/api\\/image\\/3\\/level[0-2](\\.json)?$)|(^level[0-2]$)');\n\nfunction generateVersion1Options(iiifInfo) {\n  var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(); // Version 1.0 and 1.1 do not require a profile.\n\n  if (levelProfile === undefined) {\n    levelProfile = IIIF_PROFILE_VALUES[Versions.VERSION1]['level0'];\n  }\n\n  return {\n    url: iiifInfo.imageInfo['@id'] === undefined ? undefined : iiifInfo.imageInfo['@id'].replace(/\\/?(info.json)?$/g, ''),\n    supports: levelProfile.supports,\n    formats: levelProfile.formats.concat([iiifInfo.imageInfo.formats === undefined ? [] : iiifInfo.imageInfo.formats]),\n    qualities: levelProfile.qualities.concat([iiifInfo.imageInfo.qualities === undefined ? [] : iiifInfo.imageInfo.qualities]),\n    resolutions: iiifInfo.imageInfo.scale_factors,\n    tileSize: iiifInfo.imageInfo.tile_width !== undefined ? iiifInfo.imageInfo.tile_height !== undefined ? [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_height] : [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_width] : iiifInfo.imageInfo.tile_height != undefined ? [iiifInfo.imageInfo.tile_height, iiifInfo.imageInfo.tile_height] : undefined\n  };\n}\n\nfunction generateVersion2Options(iiifInfo) {\n  var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\n      additionalProfile = Array.isArray(iiifInfo.imageInfo.profile) && iiifInfo.imageInfo.profile.length > 1,\n      profileSupports = additionalProfile && iiifInfo.imageInfo.profile[1].supports ? iiifInfo.imageInfo.profile[1].supports : [],\n      profileFormats = additionalProfile && iiifInfo.imageInfo.profile[1].formats ? iiifInfo.imageInfo.profile[1].formats : [],\n      profileQualities = additionalProfile && iiifInfo.imageInfo.profile[1].qualities ? iiifInfo.imageInfo.profile[1].qualities : [];\n  return {\n    url: iiifInfo.imageInfo['@id'].replace(/\\/?(info.json)?$/g, ''),\n    sizes: iiifInfo.imageInfo.sizes === undefined ? undefined : iiifInfo.imageInfo.sizes.map(function (size) {\n      return [size.width, size.height];\n    }),\n    tileSize: iiifInfo.imageInfo.tiles === undefined ? undefined : [iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.width;\n    })[0], iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.height === undefined ? tile.width : tile.height;\n    })[0]],\n    resolutions: iiifInfo.imageInfo.tiles === undefined ? undefined : iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.scaleFactors;\n    })[0],\n    supports: levelProfile.supports.concat(profileSupports),\n    formats: levelProfile.formats.concat(profileFormats),\n    qualities: levelProfile.qualities.concat(profileQualities)\n  };\n}\n\nfunction generateVersion3Options(iiifInfo) {\n  var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\n      formats = iiifInfo.imageInfo.extraFormats === undefined ? levelProfile.formats : levelProfile.formats.concat(iiifInfo.imageInfo.extraFormats),\n      preferredFormat = iiifInfo.imageInfo.preferredFormats !== undefined && Array.isArray(iiifInfo.imageInfo.preferredFormats) && iiifInfo.imageInfo.preferredFormats.length > 0 ? iiifInfo.imageInfo.preferredFormats.filter(function (format) {\n    return ['jpg', 'png', 'gif'].includes(format);\n  }).reduce(function (acc, format) {\n    return acc === undefined && formats.includes(format) ? format : acc;\n  }, undefined) : undefined;\n  return {\n    url: iiifInfo.imageInfo['id'],\n    sizes: iiifInfo.imageInfo.sizes === undefined ? undefined : iiifInfo.imageInfo.sizes.map(function (size) {\n      return [size.width, size.height];\n    }),\n    tileSize: iiifInfo.imageInfo.tiles === undefined ? undefined : [iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.width;\n    })[0], iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.height;\n    })[0]],\n    resolutions: iiifInfo.imageInfo.tiles === undefined ? undefined : iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.scaleFactors;\n    })[0],\n    supports: iiifInfo.imageInfo.extraFeatures === undefined ? levelProfile.supports : levelProfile.supports.concat(iiifInfo.imageInfo.extraFeatures),\n    formats: formats,\n    qualities: iiifInfo.imageInfo.extraQualities === undefined ? levelProfile.qualities : levelProfile.qualities.concat(iiifInfo.imageInfo.extraQualities),\n    preferredFormat: preferredFormat\n  };\n}\n\nvar versionFunctions = {};\nversionFunctions[Versions.VERSION1] = generateVersion1Options;\nversionFunctions[Versions.VERSION2] = generateVersion2Options;\nversionFunctions[Versions.VERSION3] = generateVersion3Options;\n/**\n * @classdesc\n * Format for transforming IIIF Image API image information responses into\n * IIIF tile source ready options\n *\n * @api\n */\n\nvar IIIFInfo =\n/** @class */\nfunction () {\n  /**\n   * @param {string|ImageInformationResponse} imageInfo\n   * Deserialized image information JSON response object or JSON response as string\n   */\n  function IIIFInfo(imageInfo) {\n    this.setImageInfo(imageInfo);\n  }\n  /**\n   * @param {string|ImageInformationResponse} imageInfo\n   * Deserialized image information JSON response object or JSON response as string\n   * @api\n   */\n\n\n  IIIFInfo.prototype.setImageInfo = function (imageInfo) {\n    if (typeof imageInfo == 'string') {\n      this.imageInfo = JSON.parse(imageInfo);\n    } else {\n      this.imageInfo = imageInfo;\n    }\n  };\n  /**\n   * @returns {Versions} Major IIIF version.\n   * @api\n   */\n\n\n  IIIFInfo.prototype.getImageApiVersion = function () {\n    if (this.imageInfo === undefined) {\n      return;\n    }\n\n    var context = this.imageInfo['@context'] || 'ol-no-context';\n\n    if (typeof context == 'string') {\n      context = [context];\n    }\n\n    for (var i = 0; i < context.length; i++) {\n      switch (context[i]) {\n        case 'http://library.stanford.edu/iiif/image-api/1.1/context.json':\n        case 'http://iiif.io/api/image/1/context.json':\n          return Versions.VERSION1;\n\n        case 'http://iiif.io/api/image/2/context.json':\n          return Versions.VERSION2;\n\n        case 'http://iiif.io/api/image/3/context.json':\n          return Versions.VERSION3;\n\n        case 'ol-no-context':\n          // Image API 1.0 has no '@context'\n          if (this.getComplianceLevelEntryFromProfile(Versions.VERSION1) && this.imageInfo.identifier) {\n            return Versions.VERSION1;\n          }\n\n          break;\n\n        default:\n      }\n    }\n\n    assert(false, 61);\n  };\n  /**\n   * @param {Versions} version Optional IIIF image API version\n   * @returns {string} Compliance level as it appears in the IIIF image information\n   * response.\n   */\n\n\n  IIIFInfo.prototype.getComplianceLevelEntryFromProfile = function (version) {\n    if (this.imageInfo === undefined || this.imageInfo.profile === undefined) {\n      return;\n    }\n\n    if (version === undefined) {\n      version = this.getImageApiVersion();\n    }\n\n    switch (version) {\n      case Versions.VERSION1:\n        if (COMPLIANCE_VERSION1.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n\n        break;\n\n      case Versions.VERSION3:\n        if (COMPLIANCE_VERSION3.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n\n        break;\n\n      case Versions.VERSION2:\n        if (typeof this.imageInfo.profile === 'string' && COMPLIANCE_VERSION2.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n\n        if (Array.isArray(this.imageInfo.profile) && this.imageInfo.profile.length > 0 && typeof this.imageInfo.profile[0] === 'string' && COMPLIANCE_VERSION2.test(this.imageInfo.profile[0])) {\n          return this.imageInfo.profile[0];\n        }\n\n        break;\n\n      default:\n    }\n  };\n  /**\n   * @param {Versions} version Optional IIIF image API version\n   * @returns {string} Compliance level, on of 'level0', 'level1' or 'level2' or undefined\n   */\n\n\n  IIIFInfo.prototype.getComplianceLevelFromProfile = function (version) {\n    var complianceLevel = this.getComplianceLevelEntryFromProfile(version);\n\n    if (complianceLevel === undefined) {\n      return undefined;\n    }\n\n    var level = complianceLevel.match(/level[0-2](\\.json)?$/g);\n    return Array.isArray(level) ? level[0].replace('.json', '') : undefined;\n  };\n  /**\n   * @returns {SupportedFeatures} Image formats, qualities and region / size calculation\n   * methods that are supported by the IIIF service.\n   */\n\n\n  IIIFInfo.prototype.getComplianceLevelSupportedFeatures = function () {\n    if (this.imageInfo === undefined) {\n      return;\n    }\n\n    var version = this.getImageApiVersion();\n    var level = this.getComplianceLevelFromProfile(version);\n\n    if (level === undefined) {\n      return IIIF_PROFILE_VALUES['none']['none'];\n    }\n\n    return IIIF_PROFILE_VALUES[version][level];\n  };\n  /**\n   * @param {PreferredOptions} opt_preferredOptions Optional options for preferred format and quality.\n   * @returns {import(\"../source/IIIF.js\").Options} IIIF tile source ready constructor options.\n   * @api\n   */\n\n\n  IIIFInfo.prototype.getTileSourceOptions = function (opt_preferredOptions) {\n    var options = opt_preferredOptions || {},\n        version = this.getImageApiVersion();\n\n    if (version === undefined) {\n      return;\n    }\n\n    var imageOptions = version === undefined ? undefined : versionFunctions[version](this);\n\n    if (imageOptions === undefined) {\n      return;\n    }\n\n    return {\n      url: imageOptions.url,\n      version: version,\n      size: [this.imageInfo.width, this.imageInfo.height],\n      sizes: imageOptions.sizes,\n      format: options.format !== undefined && imageOptions.formats.includes(options.format) ? options.format : imageOptions.preferredFormat !== undefined ? imageOptions.preferredFormat : 'jpg',\n      supports: imageOptions.supports,\n      quality: options.quality && imageOptions.qualities.includes(options.quality) ? options.quality : imageOptions.qualities.includes('native') ? 'native' : 'default',\n      resolutions: Array.isArray(imageOptions.resolutions) ? imageOptions.resolutions.sort(function (a, b) {\n        return b - a;\n      }) : undefined,\n      tileSize: imageOptions.tileSize\n    };\n  };\n\n  return IIIFInfo;\n}();\n\nexport default IIIFInfo;\nexport { Versions };","map":{"version":3,"sources":["../src/format/IIIFInfo.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\n * @module ol/format/IIIFInfo\n */\nimport { assert } from '../asserts.js';\n/**\n * @typedef {Object} PreferredOptions\n * @property {string} [format] Preferred image format. Will be used if the image information\n * indicates support for that format.\n * @property {string} [quality] IIIF image qualitiy.  Will be used if the image information\n * indicates support for that quality.\n */\n/**\n * @typedef {Object} SupportedFeatures\n * @property {Array<string>} [supports] Supported IIIF image size and region\n * calculation features.\n * @property {Array<string>} [formats] Supported image formats.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n */\n/**\n * @typedef {Object} TileInfo\n * @property {Array<number>} scaleFactors Supported resolution scaling factors.\n * @property {number} width Tile width in pixels.\n * @property {number} [height] Tile height in pixels. Same as tile width if height is\n * not given.\n */\n/**\n * @typedef {Object} IiifProfile\n * @property {Array<string>} [formats] Supported image formats for the image service.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n * @property {Array<string>} [supports] Supported features.\n * @property {number} [maxArea] Maximum area (pixels) available for this image service.\n * @property {number} [maxHeight] Maximum height.\n * @property {number} [maxWidth] Maximum width.\n */\n/**\n * @typedef {Object<string,string|number|Array<number|string|IiifProfile>|Object<string, number>|TileInfo>}\n *    ImageInformationResponse\n */\n/**\n * Enum representing the major IIIF Image API versions\n * @enum {string}\n */\nvar Versions = {\n    VERSION1: 'version1',\n    VERSION2: 'version2',\n    VERSION3: 'version3'\n};\n/**\n * Supported image formats, qualities and supported region / size calculation features\n * for different image API versions and compliance levels\n * @const\n * @type {Object<string, Object<string, SupportedFeatures>>}\n */\nvar IIIF_PROFILE_VALUES = {};\nIIIF_PROFILE_VALUES[Versions.VERSION1] = {\n    'level0': {\n        supports: [],\n        formats: [],\n        qualities: ['native']\n    },\n    'level1': {\n        supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n        formats: ['jpg'],\n        qualities: ['native']\n    },\n    'level2': {\n        supports: ['regionByPx', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct',\n            'sizeByConfinedWh', 'sizeByWh'],\n        formats: ['jpg', 'png'],\n        qualities: ['native', 'color', 'grey', 'bitonal']\n    }\n};\nIIIF_PROFILE_VALUES[Versions.VERSION2] = {\n    'level0': {\n        supports: [],\n        formats: ['jpg'],\n        qualities: ['default']\n    },\n    'level1': {\n        supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n        formats: ['jpg'],\n        qualities: ['default']\n    },\n    'level2': {\n        supports: ['regionByPx', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct',\n            'sizeByConfinedWh', 'sizeByDistortedWh', 'sizeByWh'],\n        formats: ['jpg', 'png'],\n        qualities: ['default', 'bitonal']\n    }\n};\nIIIF_PROFILE_VALUES[Versions.VERSION3] = {\n    'level0': {\n        supports: [],\n        formats: ['jpg'],\n        qualities: ['default']\n    },\n    'level1': {\n        supports: ['regionByPx', 'regionSquare', 'sizeByW', 'sizeByH', 'sizeByWh'],\n        formats: ['jpg'],\n        qualities: ['default']\n    },\n    'level2': {\n        supports: ['regionByPx', 'regionSquare', 'regionByPct',\n            'sizeByW', 'sizeByH', 'sizeByPct', 'sizeByConfinedWh', 'sizeByWh'],\n        formats: ['jpg', 'png'],\n        qualities: ['default']\n    }\n};\nIIIF_PROFILE_VALUES['none'] = {\n    'none': {\n        supports: [],\n        formats: [],\n        qualities: []\n    }\n};\nvar COMPLIANCE_VERSION1 = new RegExp('^https?\\:\\/\\/library\\.stanford\\.edu\\/iiif\\/image-api\\/(1\\.1\\/)?compliance\\.html#level[0-2]$');\nvar COMPLIANCE_VERSION2 = new RegExp('^https?\\:\\/\\/iiif\\.io\\/api\\/image\\/2\\/level[0-2](\\.json)?$');\nvar COMPLIANCE_VERSION3 = new RegExp('(^https?\\:\\/\\/iiif\\.io\\/api\\/image\\/3\\/level[0-2](\\.json)?$)|(^level[0-2]$)');\nfunction generateVersion1Options(iiifInfo) {\n    var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures();\n    // Version 1.0 and 1.1 do not require a profile.\n    if (levelProfile === undefined) {\n        levelProfile = IIIF_PROFILE_VALUES[Versions.VERSION1]['level0'];\n    }\n    return {\n        url: iiifInfo.imageInfo['@id'] === undefined ? undefined : iiifInfo.imageInfo['@id'].replace(/\\/?(info.json)?$/g, ''),\n        supports: levelProfile.supports,\n        formats: levelProfile.formats.concat([iiifInfo.imageInfo.formats === undefined ?\n                [] : iiifInfo.imageInfo.formats]),\n        qualities: levelProfile.qualities.concat([iiifInfo.imageInfo.qualities === undefined ?\n                [] : iiifInfo.imageInfo.qualities]),\n        resolutions: iiifInfo.imageInfo.scale_factors,\n        tileSize: iiifInfo.imageInfo.tile_width !== undefined ? (iiifInfo.imageInfo.tile_height !== undefined ?\n            [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_height] : [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_width]) :\n            (iiifInfo.imageInfo.tile_height != undefined ? [iiifInfo.imageInfo.tile_height, iiifInfo.imageInfo.tile_height] : undefined)\n    };\n}\nfunction generateVersion2Options(iiifInfo) {\n    var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(), additionalProfile = Array.isArray(iiifInfo.imageInfo.profile) && iiifInfo.imageInfo.profile.length > 1, profileSupports = additionalProfile && iiifInfo.imageInfo.profile[1].supports ? iiifInfo.imageInfo.profile[1].supports : [], profileFormats = additionalProfile && iiifInfo.imageInfo.profile[1].formats ? iiifInfo.imageInfo.profile[1].formats : [], profileQualities = additionalProfile && iiifInfo.imageInfo.profile[1].qualities ? iiifInfo.imageInfo.profile[1].qualities : [];\n    return {\n        url: iiifInfo.imageInfo['@id'].replace(/\\/?(info.json)?$/g, ''),\n        sizes: iiifInfo.imageInfo.sizes === undefined ? undefined : iiifInfo.imageInfo.sizes.map(function (size) {\n            return [size.width, size.height];\n        }),\n        tileSize: iiifInfo.imageInfo.tiles === undefined ? undefined : [\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.width;\n            })[0],\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.height === undefined ? tile.width : tile.height;\n            })[0]\n        ],\n        resolutions: iiifInfo.imageInfo.tiles === undefined ? undefined :\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.scaleFactors;\n            })[0],\n        supports: levelProfile.supports.concat(profileSupports),\n        formats: levelProfile.formats.concat(profileFormats),\n        qualities: levelProfile.qualities.concat(profileQualities)\n    };\n}\nfunction generateVersion3Options(iiifInfo) {\n    var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(), formats = iiifInfo.imageInfo.extraFormats === undefined ? levelProfile.formats : levelProfile.formats.concat(iiifInfo.imageInfo.extraFormats), preferredFormat = iiifInfo.imageInfo.preferredFormats !== undefined && Array.isArray(iiifInfo.imageInfo.preferredFormats) &&\n        iiifInfo.imageInfo.preferredFormats.length > 0 ?\n        iiifInfo.imageInfo.preferredFormats.filter(function (format) {\n            return ['jpg', 'png', 'gif'].includes(format);\n        }).reduce(function (acc, format) {\n            return acc === undefined && formats.includes(format) ? format : acc;\n        }, undefined) : undefined;\n    return {\n        url: iiifInfo.imageInfo['id'],\n        sizes: iiifInfo.imageInfo.sizes === undefined ? undefined : iiifInfo.imageInfo.sizes.map(function (size) {\n            return [size.width, size.height];\n        }),\n        tileSize: iiifInfo.imageInfo.tiles === undefined ? undefined : [\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.width;\n            })[0],\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.height;\n            })[0]\n        ],\n        resolutions: iiifInfo.imageInfo.tiles === undefined ? undefined :\n            iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.scaleFactors;\n            })[0],\n        supports: iiifInfo.imageInfo.extraFeatures === undefined ? levelProfile.supports : levelProfile.supports.concat(iiifInfo.imageInfo.extraFeatures),\n        formats: formats,\n        qualities: iiifInfo.imageInfo.extraQualities === undefined ? levelProfile.qualities : levelProfile.qualities.concat(iiifInfo.imageInfo.extraQualities),\n        preferredFormat: preferredFormat\n    };\n}\nvar versionFunctions = {};\nversionFunctions[Versions.VERSION1] = generateVersion1Options;\nversionFunctions[Versions.VERSION2] = generateVersion2Options;\nversionFunctions[Versions.VERSION3] = generateVersion3Options;\n/**\n * @classdesc\n * Format for transforming IIIF Image API image information responses into\n * IIIF tile source ready options\n *\n * @api\n */\nvar IIIFInfo = /** @class */ (function () {\n    /**\n     * @param {string|ImageInformationResponse} imageInfo\n     * Deserialized image information JSON response object or JSON response as string\n     */\n    function IIIFInfo(imageInfo) {\n        this.setImageInfo(imageInfo);\n    }\n    /**\n     * @param {string|ImageInformationResponse} imageInfo\n     * Deserialized image information JSON response object or JSON response as string\n     * @api\n     */\n    IIIFInfo.prototype.setImageInfo = function (imageInfo) {\n        if (typeof imageInfo == 'string') {\n            this.imageInfo = JSON.parse(imageInfo);\n        }\n        else {\n            this.imageInfo = imageInfo;\n        }\n    };\n    /**\n     * @returns {Versions} Major IIIF version.\n     * @api\n     */\n    IIIFInfo.prototype.getImageApiVersion = function () {\n        if (this.imageInfo === undefined) {\n            return;\n        }\n        var context = this.imageInfo['@context'] || 'ol-no-context';\n        if (typeof context == 'string') {\n            context = [context];\n        }\n        for (var i = 0; i < context.length; i++) {\n            switch (context[i]) {\n                case 'http://library.stanford.edu/iiif/image-api/1.1/context.json':\n                case 'http://iiif.io/api/image/1/context.json':\n                    return Versions.VERSION1;\n                case 'http://iiif.io/api/image/2/context.json':\n                    return Versions.VERSION2;\n                case 'http://iiif.io/api/image/3/context.json':\n                    return Versions.VERSION3;\n                case 'ol-no-context':\n                    // Image API 1.0 has no '@context'\n                    if (this.getComplianceLevelEntryFromProfile(Versions.VERSION1) && this.imageInfo.identifier) {\n                        return Versions.VERSION1;\n                    }\n                    break;\n                default:\n            }\n        }\n        assert(false, 61);\n    };\n    /**\n     * @param {Versions} version Optional IIIF image API version\n     * @returns {string} Compliance level as it appears in the IIIF image information\n     * response.\n     */\n    IIIFInfo.prototype.getComplianceLevelEntryFromProfile = function (version) {\n        if (this.imageInfo === undefined || this.imageInfo.profile === undefined) {\n            return;\n        }\n        if (version === undefined) {\n            version = this.getImageApiVersion();\n        }\n        switch (version) {\n            case Versions.VERSION1:\n                if (COMPLIANCE_VERSION1.test(this.imageInfo.profile)) {\n                    return this.imageInfo.profile;\n                }\n                break;\n            case Versions.VERSION3:\n                if (COMPLIANCE_VERSION3.test(this.imageInfo.profile)) {\n                    return this.imageInfo.profile;\n                }\n                break;\n            case Versions.VERSION2:\n                if (typeof this.imageInfo.profile === 'string' && COMPLIANCE_VERSION2.test(this.imageInfo.profile)) {\n                    return this.imageInfo.profile;\n                }\n                if (Array.isArray(this.imageInfo.profile) && this.imageInfo.profile.length > 0\n                    && typeof this.imageInfo.profile[0] === 'string' && COMPLIANCE_VERSION2.test(this.imageInfo.profile[0])) {\n                    return this.imageInfo.profile[0];\n                }\n                break;\n            default:\n        }\n    };\n    /**\n     * @param {Versions} version Optional IIIF image API version\n     * @returns {string} Compliance level, on of 'level0', 'level1' or 'level2' or undefined\n     */\n    IIIFInfo.prototype.getComplianceLevelFromProfile = function (version) {\n        var complianceLevel = this.getComplianceLevelEntryFromProfile(version);\n        if (complianceLevel === undefined) {\n            return undefined;\n        }\n        var level = complianceLevel.match(/level[0-2](\\.json)?$/g);\n        return Array.isArray(level) ? level[0].replace('.json', '') : undefined;\n    };\n    /**\n     * @returns {SupportedFeatures} Image formats, qualities and region / size calculation\n     * methods that are supported by the IIIF service.\n     */\n    IIIFInfo.prototype.getComplianceLevelSupportedFeatures = function () {\n        if (this.imageInfo === undefined) {\n            return;\n        }\n        var version = this.getImageApiVersion();\n        var level = this.getComplianceLevelFromProfile(version);\n        if (level === undefined) {\n            return IIIF_PROFILE_VALUES['none']['none'];\n        }\n        return IIIF_PROFILE_VALUES[version][level];\n    };\n    /**\n     * @param {PreferredOptions} opt_preferredOptions Optional options for preferred format and quality.\n     * @returns {import(\"../source/IIIF.js\").Options} IIIF tile source ready constructor options.\n     * @api\n     */\n    IIIFInfo.prototype.getTileSourceOptions = function (opt_preferredOptions) {\n        var options = opt_preferredOptions || {}, version = this.getImageApiVersion();\n        if (version === undefined) {\n            return;\n        }\n        var imageOptions = version === undefined ? undefined : versionFunctions[version](this);\n        if (imageOptions === undefined) {\n            return;\n        }\n        return {\n            url: imageOptions.url,\n            version: version,\n            size: [this.imageInfo.width, this.imageInfo.height],\n            sizes: imageOptions.sizes,\n            format: options.format !== undefined && imageOptions.formats.includes(options.format) ? options.format :\n                imageOptions.preferredFormat !== undefined ? imageOptions.preferredFormat : 'jpg',\n            supports: imageOptions.supports,\n            quality: options.quality && imageOptions.qualities.includes(options.quality) ?\n                options.quality : imageOptions.qualities.includes('native') ? 'native' : 'default',\n            resolutions: Array.isArray(imageOptions.resolutions) ? imageOptions.resolutions.sort(function (a, b) {\n                return b - a;\n            }) : undefined,\n            tileSize: imageOptions.tileSize\n        };\n    };\n    return IIIFInfo;\n}());\nexport default IIIFInfo;\nexport { Versions };\n//# sourceMappingURL=IIIFInfo.js.map"]},"metadata":{},"sourceType":"module"}